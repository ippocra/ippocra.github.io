<head>
    <meta charset="utf-8">
    <title>I referti ai tuoi pazienti. Senza CD, senza USB, senza attese.</title>
    <script src="https://unpkg.com/lucide@latest"></script>

    <meta name="description"
        content="Con Ippocra, la tua struttura invia TAC, risonanze e referti diagnostici direttamente al paziente. Un link sicuro al posto di un CD. Un visualizzatore DICOM integrato al posto di software da installare.">

    <link rel="stylesheet" href="{{ '/assets/css/fontawesome-free/css/all.min.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>

<body class="text-slate-700 antialiased">
    <main id="main-content">
        <!-- Hero Section -->
        <section id="hero" class="section-blank">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <div class="animate-fadeInUp" style="opacity:0;">
                    <h1 class="page-title">
                        I referti ai tuoi pazienti. Senza CD, senza USB, senza attese.
                    </h1>
                    <div class="mt-6 max-w-2xl mx-auto leading-relaxed">
                        <p class="paragraph-lg">
                            Con Ippocra, la tua struttura invia TAC, risonanze e referti diagnostici direttamente al
                            paziente. Un link sicuro al posto di un CD. Un visualizzatore DICOM integrato al posto di
                            software da installare.
                        </p>
                    </div>
                    <div class="mt-10 hero-button-container">
                        <a href="#wantIppo" class="secondary-button">
                            Prenota una demo
                        </a>
                        <a href="https://app.ippocra.com/register" target="_blank" rel="noopener noreferrer"
                            class="main-color-button">
                            Provalo
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                class="w-5 h-5 ml-2 -rotate-45">
                                <path fill-rule="evenodd"
                                    d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z"
                                    clip-rule="evenodd" />
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Problem Section -->
        <section id="problem" class="section-transparent scroll-target">
            <div class="section-container">
                <h2 class="mt-0 section-title text-center scroll-animated-item">
                    Il problema che ogni struttura conosce
                </h2>

                <div class="mt-10 faq-list scroll-animated-item">

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="fas fa-compact-disc mr-3"></i>
                            Masterizzare CD per ogni TAC o risonanza costa tempo allo staff: in media 15-20 minuti per
                            paziente.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="fas fa-exclamation-triangle mr-3"></i>
                            I pazienti perdono i CD, non riescono ad aprire i file DICOM sul proprio computer, chiamano
                            per avere copie.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="fas fa-usb mr-3"></i>
                            Le chiavette USB si smarriscono, non sono sicure e hanno un costo. Per ogni paziente, ogni
                            volta.
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- Solution Section -->
        <section id="solution" class="section-main-soft-gradient scroll-target">
            <div class="section-container">
                <h2 class="mt-0 section-title text-center scroll-animated-item">
                    Come Ippocra risolve tutto questo
                </h2>

                <div class="mt-20 icon-grid scroll-animated-item scroll-animated-item-3">

                    <!-- DICOM Viewer -->
                    <div class="mb-5 p-5">
                        <div class="justify-center text-center">
                            <i class="fas fa-x-ray small-icon-size"></i>
                        </div>
                        <h3 class="section-header text-center">
                            Visualizzatore DICOM integrato
                        </h3>
                        <p class="paragraph-md text-center">
                            Il paziente visualizza TAC, risonanze e radiografie direttamente nel browser. Strumenti professionali, nessun software da installare.
                        </p>
                    </div>

                    <!-- IppoLink -->
                    <div class="mb-5 p-5">
                        <div class="justify-center text-center">
                            <i class="fas fa-link small-icon-size"></i>
                        </div>
                        <h3 class="section-header text-center">
                            IppoLink: invia file pesanti con un link
                        </h3>
                        <p class="paragraph-md text-center">
                            Una TAC pesa centinaia di megabyte. Con IppoLink, un solo link sicuro sostituisce CD, chiavette USB e trasferimenti di file. Il paziente lo apre su qualsiasi dispositivo.
                        </p>
                    </div>

                    <!-- Time Saved -->
                    <div class="mb-5 p-5">
                        <div class="justify-center text-center">
                            <i class="fas fa-clock small-icon-size"></i>
                        </div>
                        <h3 class="section-header text-center">
                            15 minuti risparmiati per paziente
                        </h3>
                        <p class="paragraph-md text-center">
                            Niente più masterizzazione CD, niente preparazione USB, niente richiamate per supporti persi.
                        </p>
                    </div>

                </div>

                <div class="mt-10 flex justify-center scroll-animated-item">
                    <!-- Patient Experience -->
                    <div class="mb-5 p-5 max-w-md text-center">
                        <div class="justify-center text-center">
                            <i class="fas fa-heart small-icon-size" style="color:#3b9ba8;"></i>
                        </div>
                        <h3 class="section-header text-center">
                            Migliore esperienza paziente
                        </h3>
                        <p class="paragraph-md text-center">
                            Il paziente riceve una notifica, apre il link e vede le sue immagini diagnostiche. Tutto in
                            pochi secondi.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- DICOM Viewer Showcase -->
        <section id="dicom-showcase" class="section-transparent scroll-target">
            <div class="section-container">
                <h2 class="mt-0 section-title text-center scroll-animated-item">
                    Il visualizzatore DICOM in azione
                </h2>
                <p class="mt-4 paragraph-md text-center max-w-2xl mx-auto scroll-animated-item">
                    Naviga le immagini diagnostiche direttamente nel browser — nessun download, nessun plugin, nessun software speciale.
                </p>

                <!-- YouTube Video -->
                <div class="mt-10 max-w-3xl mx-auto scroll-animated-item">
                    <div style="position:relative; padding-bottom:56.25%; height:0; overflow:hidden; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.1);">
                        <iframe src="https://www.youtube.com/embed/PVsdDqWt6RE"
                            title="Demo del visualizzatore DICOM di Ippocra"
                            style="position:absolute; top:0; left:0; width:100%; height:100%; border:0;"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen loading="lazy"></iframe>
                    </div>
                </div>

                <!-- Screenshot + Capabilities -->
                <div class="mt-16 flex flex-col lg:flex-row items-center gap-10 scroll-animated-item">
                    <div class="lg:w-1/2">
                        <img src="assets/images/dicom_viewer_knee_it.webp"
                             alt="Visualizzatore DICOM che mostra una risonanza al ginocchio in Ippocra"
                             style="border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.1); width:100%; height:auto;">
                    </div>
                    <div class="lg:w-1/2">
                        <h3 class="section-header">Strumenti professionali per ogni paziente</h3>
                        <div class="mt-6 space-y-4">
                            <div class="flex items-start gap-3">
                                <i class="fas fa-layer-group mt-1" style="color:#3b9ba8;"></i>
                                <div>
                                    <p class="paragraph-md" style="margin:0;"><strong>Navigazione tra le sezioni</strong></p>
                                    <p class="paragraph-md text-gray-600" style="margin:0;">Scorri le sezioni trasversali di TAC e risonanze, proprio come su una workstation radiologica.</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <i class="fas fa-adjust mt-1" style="color:#3b9ba8;"></i>
                                <div>
                                    <p class="paragraph-md" style="margin:0;"><strong>Windowing</strong></p>
                                    <p class="paragraph-md text-gray-600" style="margin:0;">Regola contrasto e luminosità per evidenziare ossa, tessuti molli o organi.</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <i class="fas fa-ruler mt-1" style="color:#3b9ba8;"></i>
                                <div>
                                    <p class="paragraph-md" style="margin:0;"><strong>Misurazioni e annotazioni</strong></p>
                                    <p class="paragraph-md text-gray-600" style="margin:0;">Misura distanze e aree direttamente sulle immagini.</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <i class="fas fa-cube mt-1" style="color:#3b9ba8;"></i>
                                <div>
                                    <p class="paragraph-md" style="margin:0;"><strong>Ricostruzione multi-planare</strong></p>
                                    <p class="paragraph-md text-gray-600" style="margin:0;">Visualizza gli esami da prospettive assiale, coronale e sagittale.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sponsored Plan Section -->
        <section id="fse" class="section-main-hard-gradient scroll-target">
            <div class="flex flex-col items-center section-container">
                <div class="scroll-animated-item max-w-3xl">
                    <h2 class="mt-0 section-title text-white text-center">
                        Il Piano Sponsorizzato: fidelizza i pazienti con un vantaggio concreto
                    </h2>
                    <p class="mt-7 text-white text-center paragraph-md">
                        Quando invii referti tramite Ippocra, i pazienti possono creare un account gratuito collegato alla tua struttura.
                        Finché tornano per un esame almeno una volta all'anno, il loro piano resta attivo — e con esso
                        l'intera storia clinica. Il tuo brand resta visibile su ogni referto che aprono.
                        Fidelizzazione integrata nel flusso di lavoro: nessuno sforzo aggiuntivo, nessuna campagna necessaria.
                    </p>
                    <div class="mt-10 grid grid-cols-1 md:grid-cols-3 gap-6 text-white text-center">
                        <div class="flex flex-col items-center gap-2">
                            <i class="fas fa-tag text-2xl" style="opacity:0.85;"></i>
                            <p class="paragraph-md" style="margin:0;"><strong>Il tuo logo su ogni referto</strong></p>
                        </div>
                        <div class="flex flex-col items-center gap-2">
                            <i class="fas fa-history text-2xl" style="opacity:0.85;"></i>
                            <p class="paragraph-md" style="margin:0;"><strong>Storia clinica attiva con visite annuali</strong></p>
                        </div>
                        <div class="flex flex-col items-center gap-2">
                            <i class="fas fa-check-circle text-2xl" style="opacity:0.85;"></i>
                            <p class="paragraph-md" style="margin:0;"><strong>Zero sforzo — integrato nel workflow</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="section-main-soft-gradient scroll-target">
            <div class="section-container">
                <h2 class="mt-0 section-title text-center scroll-animated-item">
                    Funzionalità principali
                </h2>

                <div class="mt-20 icon-grid scroll-animated-item scroll-animated-item-3">

                    <!-- DICOM Upload -->
                    <div class="mb-5 p-5">
                        <div class="justify-center text-center">
                            <i class="fas fa-upload small-icon-size"></i>
                        </div>
                        <h3 class="section-header text-center">
                            Caricamento DICOM, PDF e immagini
                        </h3>
                        <p class="paragraph-md text-center">
                            Carica qualsiasi formato diagnostico: DICOM, PDF, JPEG. Il sistema li organizza
                            automaticamente.
                        </p>
                    </div>

                    <!-- Visualizzatore integrato -->
                    <div class="mb-5 p-5">
                        <div class="justify-center text-center">
                            <i class="fas fa-x-ray small-icon-size"></i>
                        </div>
                        <h3 class="section-header text-center">
                            Visualizzatore DICOM nel browser
                        </h3>
                        <p class="paragraph-md text-center">
                            TAC, risonanze e radiografie visualizzabili direttamente nel browser, senza installare
                            alcun software.
                        </p>
                    </div>

                    <!-- Ricerca intelligente -->
                    <div class="mb-5 p-5">
                        <div class="justify-center text-center">
                            <i class="fas fa-search small-icon-size"></i>
                        </div>
                        <h3 class="section-header text-center">
                            Ricerca intelligente
                        </h3>
                        <p class="paragraph-md text-center">
                            Trova qualsiasi referto in pochi secondi, anche tra migliaia di documenti.
                        </p>
                    </div>

                    <!-- Analisi aziendale -->
                    <div class="mb-5 p-5">
                        <div class="justify-center text-center">
                            <i class="fas fa-chart-bar small-icon-size"></i>
                        </div>
                        <h3 class="section-header text-center">
                            Analisi aziendale
                        </h3>
                        <p class="paragraph-md text-center">
                            Monitoraggio costante del volume di documenti, delle spedizioni e delle prestazioni.
                        </p>
                    </div>

                    <!-- Accesso sicuro -->
                    <div class="mb-5 p-5">
                        <div class="justify-center text-center">
                            <i class="fas fa-lock small-icon-size"></i>
                        </div>
                        <h3 class="section-header text-center">
                            Accesso sicuro
                        </h3>
                        <p class="paragraph-md text-center">
                            Gestione delle autorizzazioni per evitare rischi e garantire la sicurezza dei dati
                            diagnostici.
                        </p>
                    </div>

                </div>
            </div>
        </section>


        <!-- Connector -->
        <section id="connector" class="section-blank scroll-target">
            <div class="flex flex-row section-container scroll-animated-item">
                <div class="card-info">
                    <h2 class="mt-0 section-title">Si integra con il tuo ERP</h2>
                    <p class="mt-7 paragraph-md paragraph-bold">
                        Ippocra si collega nativamente ai principali software clinici: importa e gestisci i dati senza
                        cambiare abitudini o interrompere i flussi. Zero stress, solo efficienza.
                    </p>
                    <a href="#wantIppo" class="mt-7 secondary-button">
                        Prenota una demo
                    </a>
                </div>

                <div class="p-16 max-w-sm card-image scroll-animated-item">
                    <img class="w-full" src="assets/images/ippo-outline-green.webp" alt="ippo">
                </div>
            </div>
        </section>


        <!-- join -->
        <section id="join" class="section-accent-soft-gradient scroll-target">
            <div class="text-center section-container">
                <div class="scroll-animated-item">
                    <h2 class="mt-0 section-title text-center">Gestione dei referti che semplifica il lavoro</h2>
                    <p class="mt-7 mb-0 text-center paragraph-md paragraph-bold">
                        Con Ippocra ottieni il pieno controllo della gestione dei referti: risparmiando tempo, riducendo
                        errori e migliorando il servizio, dando serenità a pazienti e personale.
                    </p>
                    <a href="https://app.ippocra.com/a/en/register" target="_blank" rel="noopener noreferrer"
                        class="mt-10 main-color-button">
                        Inizia la prova gratuita

                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                            class="w-5 h-5 ml-2 -rotate-45">
                            <path fill-rule="evenodd"
                                d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z"
                                clip-rule="evenodd" />
                        </svg>
                    </a>
                </div>
                <div class="mt-10 image-frame scroll-animated-item">
                    <img class="w-full" src="assets/images/business-images/analytics-it.png" alt="Analytics">
                </div>
            </div>

        </section>

        <!-- Want Ippocra? -->
        <section id="wantIppo" class="section-main-hard-gradient">
            <div class="section-container max-w-6xl mx-auto px-4">
                <div class="flex flex-col lg:flex-row gap-10">

                    <!-- ==================== LEFT COLUMN – INFO ==================== -->
                    <div class="flex flex-col w-full lg:w-2/5 space-y-8">

                        <!-- Title & Intro -->
                        <div class="text-center lg:text-left">
                            <h2 class="mt-0 section-title">
                                Vuoi provare Ippocra nella tua clinica?
                            </h2>
                            <p class="mt-7 text-white paragraph-md">
                                Prenota una demo su misura e scopri come organizzare e gestire i tuoi referti in modo
                                efficiente.
                            </p>
                        </div>

                        <!-- Contact Info -->
                        <div class="mt-10 grid gap-3 text-white">

                            <!-- Email -->
                            <div class="flex items-center gap-3 text-white">
                                <i class="fas fa-envelope fa-lg"></i>
                                <a href="mailto:info@ippocra.com" class="text-white hover:underline">
                                    info@ippocra.com
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- ==================== RIGHT COLUMN – FORM ==================== -->
                    <div class="contact-form lg:w-3/5 space-y-8">
                        <h2 class="mt-0 section-header">Richiedi una demo gratuita</h2>

                        <form id="ippocraForm" method="POST"
                            action="https://hook.eu2.make.com/kmko599vdgvoi5xyyttkq4h2g3b9uys9"
                            class="mt-10 p-0 mb-0 grid gap-4">

                            <!-- Name -->
                            <div>
                                <label for="name" class="sr-only">Nome</label>
                                <input type="text" id="name" name="name" class="input-field" required
                                    placeholder="Il tuo nome">
                            </div>

                            <div>
                                <label for="lastname" class="sr-only">Cognome</label>
                                <input type="text" id="lastname" name="lastname" class="input-field" required
                                    placeholder="Il tuo cognome">
                            </div>

                            <!-- Email -->
                            <div>
                                <label for="email" class="sr-only">Indirizzo email</label>
                                <input type="email" id="email" name="email" class="input-field"
                                    pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" required
                                    placeholder="email@esempio.com">
                            </div>

                            <!-- Phone -->
                            <div>
                                <label for="phone_prefix" class="sr-only">Prefisso internazionale</label>
                                <div class="flex gap-2 items-center">
                                    <!-- smaller prefix select -->
                                    <select id="phone_prefix" name="phone_prefix" class="input-field flex-2 w-2"
                                        aria-label="Prefisso internazionale">
                                        <option value="0039">0039</option>
                                        <option value="001">001</option>
                                        <option value="0044">0044</option>
                                        <option value="0049">0049</option>
                                        <option value="0033">0033</option>
                                        <option value="0034">0034</option>
                                        <option value="007">007</option>
                                        <option value="0061">0061</option>
                                        <option value="other">Altro…</option>
                                    </select>

                                    <!-- larger phone input (takes remaining space) -->
                                    <input type="tel" id="phone" name="phone" class="input-field flex-3 min-w-3"
                                        inputmode="tel" pattern="[0-9]*" required placeholder="Telefono (solo numeri)">
                                </div>

                                <!-- campo per inserire un prefisso personalizzato quando si sceglie "Altro" -->
                                <div id="phone_prefix_custom_wrap" class="mt-2 hidden">
                                    <label for="phone_prefix_custom" class="sr-only">Prefisso personalizzato</label>
                                    <input type="text" id="phone_prefix_custom" name="phone_prefix_custom"
                                        class="input-field w-20" placeholder="0039" inputmode="tel"
                                        aria-label="Prefisso personalizzato">
                                </div>
                            </div>

                            <!-- Message / Demo request -->
                            <div>
                                <label for="message" class="sr-only">Messaggio</label>
                                <textarea id="message" name="message" rows="4" class="input-field" required
                                    placeholder="Raccontaci qualcosa sulla tua clinica e cosa vorresti vedere"></textarea>
                            </div>

                            <!-- Submit button -->
                            <div class="text-center">
                                <button class="submit-button" type="submit">
                                    Richiedi la demo
                                </button>
                            </div>
                        </form>

                        <div id="thanksMsg" class="hidden text-center text-green-600 font-medium mt-4">
                            Grazie! Abbiamo ricevuto la tua richiesta.
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- FAQ -->
        <section id="faq" class="section-transparent">
            <div class="section-container">
                <div class="flex flex-col">
                    <div>
                        <h2 class="mt-0 section-title text-center">
                            Domande frequenti
                        </h2>
                        <p class="mt-7 paragraph-md">
                            Se hai altre domande, contattaci e saremo felici di rispondere a qualsiasi tua richiesta.
                        </p>
                    </div>
                </div>

                <!-- FAQ List -->
                <div class="mt-10 faq-list">

                    <details class="faq-item">
                        <summary class="faq-question">
                            Come funziona l'invio dei referti diagnostici?
                        </summary>
                        <div class="faq-answer">
                            Basta caricare il file (DICOM, PDF o immagine) su Ippocra. Il sistema genera
                            automaticamente un link sicuro (IppoLink) che puoi inviare al paziente via email o SMS. Il
                            paziente apre il link e visualizza tutto nel browser.
                        </div>
                    </details>

                    <details class="faq-item">
                        <summary class="faq-question">
                            I file DICOM sono visualizzabili senza software?
                        </summary>
                        <div class="faq-answer">
                            Sì. Ippocra include un visualizzatore DICOM integrato nel browser. I pazienti possono vedere
                            TAC, risonanze e radiografie senza installare nulla.
                        </div>
                    </details>

                    <details class="faq-item">
                        <summary class="faq-question">
                            Quanto tempo si risparmia rispetto ai CD?
                        </summary>
                        <div class="faq-answer">
                            In media 15-20 minuti per paziente tra masterizzazione, etichettatura e consegna. Con
                            Ippocra, l'invio è immediato e automatico.
                        </div>
                    </details>

                    <details class="faq-item">
                        <summary class="faq-question">
                            Come aumenta Ippocra la fidelizzazione dei pazienti?
                        </summary>
                        <div class="faq-answer">
                            Personalizziamo i link dei referti con il tuo logo e le tue informazioni di contatto. I
                            pazienti che creano account dai tuoi referti sono inoltre incentivati a tornare: i pazienti
                            di ritorno ottengono l'estensione dei loro piani Ippocra.
                        </div>
                    </details>

                </div>
                <!-- FAQ List END -->
            </div>
        </section>
    </main>

    <script>
        // Initial load animations for hero
        document.addEventListener('DOMContentLoaded', () => {
            const heroContent = document.querySelector('#hero .animate-fadeInUp');
            if (heroContent) heroContent.style.opacity = '1';

            const ctaSectionContent = document.querySelector('.cta-bg-gradient .animate-fadeInUp');
            if (ctaSectionContent) ctaSectionContent.style.opacity = '1';
        });

        // Fade in elements on initial load
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.animate-fadeInUp').forEach(el => {
                el.style.opacity = '1';
            });
        });


        // Generic function to observe and animate sections
        function observeAndAnimate(selector, visibleClass = 'is-visible', threshold = 0.1) {
            const el = document.querySelector(selector);
            if (!el) return;

            const observer = new IntersectionObserver((entries) => {
                const entry = entries[0];
                if (entry.isIntersecting) {
                    el.classList.add(visibleClass);
                    observer.unobserve(el); // Stop observing after it becomes visible
                }
            }, { threshold });

            observer.observe(el);
        }

        observeAndAnimate('#problem');
        observeAndAnimate('#solution');
        observeAndAnimate('#dicom-showcase');
        observeAndAnimate('#fse');
        observeAndAnimate('#features');
        observeAndAnimate('#connector');
        observeAndAnimate('#join');
        observeAndAnimate('#faq');

        lucide.createIcons();
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const form = document.getElementById('ippocraForm');
            if (!form) return;

            const btn = form.querySelector('button[type="submit"]') || form.querySelector('.submit-button');
            const thanks = document.getElementById('thanksMsg');

            const phoneEl = document.getElementById('phone');
            const prefixEl = document.getElementById('phone_prefix');
            const customWrap = document.getElementById('phone_prefix_custom_wrap');
            const customEl = document.getElementById('phone_prefix_custom');

            // show/hide custom prefix input when user selects "Altro"
            if (prefixEl && customWrap && customEl) {
                const toggleCustom = () => {
                    if (prefixEl.value === 'other') {
                        customWrap.classList.remove('hidden');
                        customEl.required = true;
                        customEl.focus();
                    } else {
                        customWrap.classList.add('hidden');
                        customEl.required = false;
                        customEl.value = '';
                    }
                };
                prefixEl.addEventListener('change', toggleCustom);
                toggleCustom();
            }

            // keep phone input numeric while typing
            if (phoneEl) {
                phoneEl.addEventListener('input', (e) => {
                    const cleaned = e.target.value.replace(/\D/g, '');
                    if (e.target.value !== cleaned) e.target.value = cleaned;
                });
            }

            form.addEventListener('submit', async (e) => {
                e.preventDefault();                 // blocchiamo il submit tradizionale

                if (btn) {
                    btn.disabled = true;                // evitiamo doppi click
                    btn.dataset.originalText = btn.innerHTML;
                    btn.innerHTML = '<svg class="animate-spin h-5 w-5 mr-2 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4l3-3-3-3v4a8 8 0 00-8 8z"/></svg> Invio…';
                }

                try {
                    // costruisci FormData e concatena prefisso+numero (solo cifre, senza spazi)
                    const formData = new FormData(form);

                    // escape della descrizione/messaggio per essere valido come stringa JSON
                    const messageEl = form.querySelector('#message');
                    if (messageEl) {
                        const rawMsg = messageEl.value || '';
                        // JSON.stringify produce una stringa quotata e correttamente escape-ata;
                        // rimuoviamo le virgolette esterne per ottenere il contenuto escape-ato.
                        const escapedMsg = JSON.stringify(rawMsg).slice(1, -1);
                        formData.set('message', escapedMsg);
                    }

                    // determina prefisso (select o custom)
                    let prefixValue = '';
                    if (prefixEl) {
                        if (prefixEl.value === 'other' && customEl) {
                            prefixValue = customEl.value || '';
                        } else {
                            prefixValue = prefixEl.value || '';
                        }
                    }

                    // prendi il numero locale e mantieni solo le cifre
                    const rawPhone = phoneEl ? phoneEl.value : '';
                    const digitsOnlyPhone = (rawPhone || '').replace(/\D/g, '');

                    // valida che il numero locale contenga esattamente 7 cifre
                    if (digitsOnlyPhone.length !== 7) {
                        throw new Error('Telefono non valido: il numero locale deve contenere esattamente 7 cifre');
                    }

                    // combina prefisso + numero (solo cifre)
                    const combined = (prefixValue + digitsOnlyPhone).replace(/\D/g, '');

                    if (!combined) throw new Error('Telefono non valido');

                    // sovrascrivi il campo phone con il valore combinato (solo cifre)
                    formData.set('phone', combined);
                    // rimuovi i singoli campi legati al prefisso per evitare duplicati
                    formData.delete('phone_prefix');
                    formData.delete('phone_prefix_custom');

                    const response = await fetch(form.action, {
                        method: 'POST',
                        body: formData,
                    });

                    if (!response.ok) {
                        let errMsg = `Errore ${response.status}`;
                        const ct = response.headers.get('content-type') || '';
                        if (ct.includes('application/json')) {
                            const data = await response.json();
                            errMsg += ': ' + (data.message || JSON.stringify(data));
                        } else {
                            const txt = await response.text();
                            errMsg += ': ' + txt;
                        }
                        throw new Error(errMsg);
                    }

                    // consume JSON if present
                    const ct = response.headers.get('content-type') || '';
                    if (ct.includes('application/json')) {
                        await response.json();
                    }

                    // Success
                    form.reset();
                    if (thanks) {
                        thanks.classList.remove('hidden');
                        setTimeout(() => thanks.classList.add('hidden'), 5000);
                    }
                } catch (err) {
                    console.error('Submit fallito:', err);
                    // mostra il messaggio d'errore specifico se presente
                    alert(err && err.message ? err.message : 'Si è verificato un problema durante l\'invio. Per favore riprova più tardi.');
                } finally {
                    if (btn) {
                        btn.disabled = false;
                        btn.innerHTML = btn.dataset.originalText || 'Invia';
                    }
                }
            });
        });
    </script>
</body>